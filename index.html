<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Auction House Prices</title>
    <script src="https://wow.zamimg.com/widgets/power.js"></script>
    <style>
      * {
        padding: 0;
        margin: 0;
        font-family: Arial;
      }

      body {
        padding: 20px;
        background-color: rgb(32, 32, 32);
        color: white;
      }

      .grid-container {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 20px;
        padding: 20px;
      }

      a {
        text-decoration: none;
      }

      .item {
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 5px;
      }

      /* Example rarity colors */
      .common {
        color: #ffffff;
      }
      .uncommon {
        color: #1eff00;
      }
      .rare {
        color: #0070dd;
      }
      .epic {
        color: #a335ee;
      }
      .legendary {
        color: #ff8000;
      }

      .gold-icon {
        width: 16px;
        height: 16px;
        background-image: url("https://wow.zamimg.com/images/icons/money-gold.gif"); /* Path to your gold icon image */
        display: inline-block;
        background-size: contain;
        margin-right: 4px;
      }

      .price {
        color: white;
      }
    </style>
  </head>
  <body>
    <h1>Auction House Prices by Item and Region</h1>
    <div id="items-grid" class="grid-container"></div>
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        fetchData();
      });

      async function fetchData() {
        // Simulating a fetch request - replace with actual fetch from your backend
        const response = await fetch("python-backend/data/latest_item_prices.json");
        const json = await response.json();

        displayData(json);
      }

      function displayData(data) {
        const grid = document.getElementById("items-grid");
        data.data.forEach((region) => {
          const regionContainer = document.createElement("div");
          regionContainer.innerHTML = `<h2>${region.region.toUpperCase()}</h2>`;
          displayMainItem(region.data, regionContainer);
          grid.appendChild(regionContainer);
        });
      }

      function displayMainItem(itemData, container) {
        const mainItemElement = createItemElement(itemData);
        container.appendChild(mainItemElement);

        if (itemData.hasOwnProperty("parts") && itemData.parts.length > 0) {
          itemData.parts.forEach((part) => {
            processItem(part, container); // Recursively process each part
          });
        }
      }

      function processItem(part, container) {
        const itemElement = createItemElement(part);
        container.appendChild(itemElement);

        if (part.parts && part.parts.length > 0) {
          part.parts.forEach((subPart) => {
            processItem(subPart, container); // Recursive call to process nested parts
          });
        }
      }

      function createItemElement(item) {
        const itemElement = document.createElement("div");
        itemElement.classList.add("item", item.quality);
        itemElement.innerHTML = `
        <a href="https://www.wowhead.com/item=${item.id}" class="${getQualityClass(item.quality)}" data-wowhead="item=${
          item.id
        }">
            ${item.name}
        </a> 
        <span class="price">
            <span class="gold-icon"></span>${formatGold(item.price)}
        </span>
    `;
        return itemElement;
      }

      function formatGold(price) {
        // Converts price to gold assuming the price is in copper
        return Math.floor(price / 10000); // Adjust if your price unit differs
      }

      function getQualityClass(quality) {
        // Converts quality to a class name used for coloring
        const qualityClasses = {
          common: "common",
          uncommon: "uncommon",
          rare: "rare",
          epic: "epic",
          legendary: "legendary",
          artifact: "artifact",
        };
        return qualityClasses[quality] || "common";
      }
    </script>
  </body>
</html>
